# 消息通知入口配置说明

## ✅ 已完成的配置

### 1. **路由注册** (`pages.json`)

已在 `pages.json` 中注册消息通知页面：

```json
{
  "path": "pages/notification/notification",
  "style": {
    "navigationBarTitleText": "消息中心",
    "navigationStyle": "custom"
  }
}
```

### 2. **"我的"页面入口** (`pages/user/user.vue`)

在"我的"页面添加了消息中心入口：

#### 显示位置
- 位于"我的优惠券"和"我的钱包"之间
- 使用闹钟图标 (`ic_alarm.png`)
- 显示未读消息徽标（红点数字）

#### 代码位置
```vue
<view class="weui-cell weui-cell_access" hover-class="weui-cell_active" @tap="toNotification">
  <view class="weui-cell__hd">
    <image src="/static/images/ic_alarm.png"
      style="display: block; float: left; margin-right: 20rpx; width: 20px; height: 20px"></image>
  </view>
  <view class="weui-cell__bd">消息中心</view>
  <view class="weui-cell__ft weui-cell__ft_in-access">
    <text v-if="unreadCount > 0" class="badge">{{ unreadCount }}</text>
  </view>
</view>
```

### 3. **功能实现**

#### 响应式数据
```javascript
const unreadCount = ref(0) // 未读消息数量
```

#### 页面跳转方法
```javascript
// 去消息中心
const toNotification = () => {
  uni.navigateTo({
    url: '/pages/notification/notification'
  })
}
```

#### 加载未读消息
```javascript
// 加载未读消息数量
const loadUnreadCount = async () => {
  try {
    const res = await request({
      url: '/user/notifications/stat',
      method: 'GET'
    })
    
    if (res.code === 200) {
      unreadCount.value = res.data.unreadCount || 0
    }
  } catch (error) {
    console.error('获取未读消息数量失败:', error)
  }
}
```

#### 生命周期调用
```javascript
onMounted(() => {
  getUserInfo()
  loadUnreadCount()  // 页面加载时获取未读数
})

onShow(() => {
  if (uni.getStorageSync('token')) {
    getUserInfo()
    loadUnreadCount()  // 页面显示时刷新未读数
  }
})
```

### 4. **样式设计**

#### 未读徽标样式
```scss
.badge {
  display: inline-block;
  min-width: 32rpx;
  height: 32rpx;
  line-height: 32rpx;
  padding: 0 8rpx;
  background: #ff4d4f;      // 红色背景
  color: #fff;              // 白色文字
  font-size: 20rpx;         // 小号字体
  text-align: center;
  border-radius: 16rpx;     // 圆角
  margin-left: 8rpx;
}
```

## 📍 页面入口位置

### "我的"页面菜单顺序
1. 个人信息
2. 我的优惠券
3. **消息中心** ⬅️ 新增
4. 我的钱包
5. 地址管理
6. 我的次卡
7. 我的评价
8. 分享转发
9. 退出登录

## 🔔 未读消息徽标显示规则

### 显示条件
- 当 `unreadCount > 0` 时显示红色徽标
- 徽标内显示具体未读数量
- 未读数量为 0 时不显示徽标

### 徽标更新时机
1. **页面加载时** - `onMounted` 生命周期
2. **页面显示时** - `onShow` 生命周期（从消息中心返回时会刷新）
3. **自动刷新** - 可以配合 App.vue 的全局消息监听

## 🎯 用户使用流程

### 查看消息的完整流程
```
1. 用户进入"我的"页面
   ↓
2. 看到"消息中心"入口及未读徽标
   ↓
3. 点击"消息中心"
   ↓
4. 跳转到消息通知页面
   ↓
5. 查看消息列表
   ↓
6. 点击消息标记为已读或跳转
   ↓
7. 返回"我的"页面
   ↓
8. 未读徽标自动更新
```

## 🔌 后端接口

### 获取未读消息统计
```
GET /user/notifications/stat

响应数据：
{
  "code": 200,
  "data": {
    "unreadCount": 5,           // 总未读数
    "orderUnreadCount": 2,      // 订单类未读
    "serviceUnreadCount": 1,    // 服务类未读
    "paymentUnreadCount": 1,    // 支付类未读
    "systemUnreadCount": 1      // 系统类未读
  }
}
```

## 🎨 视觉效果

### 徽标样式特点
- 🔴 **醒目红色** - 使用 `#ff4d4f` 红色背景
- ⚪ **白色数字** - 清晰易读
- 🔘 **圆角设计** - 柔和美观
- 📏 **最小宽度** - 保证单个数字时也是圆形
- 📍 **右侧显示** - 位于菜单项右侧

### 示例效果
```
消息中心        [5]  >
```
当未读数为 0 时：
```
消息中心             >
```

## 📱 测试建议

### 测试场景
1. **无消息时** - 徽标不显示
2. **有未读消息** - 徽标显示对应数字
3. **进入消息中心后返回** - 徽标数字自动更新
4. **全部标记已读** - 徽标消失

### 测试步骤
1. 清空所有消息，检查徽标不显示
2. 后台创建测试消息，检查徽标显示
3. 进入消息中心，检查消息列表
4. 标记消息已读，返回检查徽标更新
5. 全部已读后，检查徽标消失

## 🔧 维护说明

### 图标资源
- 消息中心图标：`/static/images/ic_alarm.png`
- 确保图标文件存在且清晰

### 接口依赖
- 依赖后端接口：`/user/notifications/stat`
- 确保接口正常返回数据

### 性能优化
- 使用异步加载，不阻塞页面渲染
- 失败时静默处理，不影响用户体验

## 🎉 完成状态

✅ 路由配置完成  
✅ 入口菜单添加完成  
✅ 未读徽标显示完成  
✅ 跳转功能完成  
✅ 自动刷新完成  
✅ 样式美化完成

消息通知功能现在已经完全可见和可用！

