# 用户端钱包功能说明

## 📋 功能概述

用户端钱包功能已完成，主要功能包括：
- ✅ 钱包余额显示
- ✅ 余额明细查看
- ✅ 交易记录查看
- ✅ 充值功能（跳转到充值页面）

## 🎯 与阿姨端的区别

### 用户端特点
1. **充值为主** - 用户需要充值来支付服务费用
2. **消费记录** - 主要查看消费和退款记录
3. **无提现功能** - 用户端不需要提现功能
4. **无银行卡管理** - 用户端不需要绑定银行卡
5. **简洁界面** - 功能更简洁，聚焦于充值和查账

### 阿姨端特点
1. **收入为主** - 阿姨接单获得收入
2. **提现功能** - 支持多种提现方式（微信、支付宝、银行卡）
3. **银行卡管理** - 需要绑定银行卡用于提现
4. **收入统计** - 详细的收入分类统计
5. **信誉评分** - 展示阿姨的信誉积分

## 📦 已实现的功能

### 1. 钱包首页 (`pages/user/wallet.vue`)

**显示信息：**
- 钱包余额（大字显示）
- 冻结金额（订单支付但服务未完成的金额）
- 累计消费（历史总消费金额）

**功能按钮：**
- 充值按钮 - 跳转到充值页面
- 余额明细 - 查看余额变动记录
- 交易记录 - 查看所有交易记录

### 2. 余额明细弹窗

**功能特性：**
- 分页加载余额变动记录
- 显示变动类型、金额、时间
- 区分收入（红色+号）和支出（绿色-号）
- 显示变动后的余额
- 上拉加载更多

**数据字段：**
- `typeDesc`: 变动类型描述（充值、支付、退款等）
- `changeAmount`: 变动金额
- `balanceAfter`: 变动后余额
- `description`: 变动说明
- `createdTime`: 变动时间

### 3. 交易记录弹窗

**功能特性：**
- 交易类型筛选（全部、充值、支付、退款）
- 分页加载交易记录
- 显示交易状态（成功、处理中、失败）
- 显示交易金额和时间
- 上拉加载更多

**交易类型：**
- `RECHARGE` - 充值
- `PAYMENT` - 支付
- `REFUND` - 退款

**交易状态：**
- `SUCCESS` - 成功（绿色）
- `PENDING` - 处理中（橙色）
- `FAILED` - 失败（红色）

## 🎨 UI设计特点

### 视觉风格
- **渐变背景** - 紫色渐变背景（#667eea → #764ba2）
- **毛玻璃效果** - 余额卡片使用半透明背景 + 背景模糊
- **圆角设计** - 所有卡片和按钮都使用圆角
- **清晰层次** - 明确的视觉层次和间距

### 交互体验
- **底部弹窗** - 余额明细和交易记录使用底部弹窗展示
- **筛选功能** - 交易记录支持类型筛选
- **无限滚动** - 自动加载更多数据
- **状态提示** - 清晰的加载中、无数据、无更多提示

## 🔌 后端接口对接

### 1. 获取钱包信息
```javascript
GET /user/wallet

响应数据：
{
  "balance": 299.50,          // 可用余额
  "frozenAmount": 50.00,      // 冻结金额
  "totalExpense": 1500.00,    // 累计消费
  "createdTime": "2024-01-01T10:00:00",
  "updatedTime": "2024-01-15T15:30:00"
}
```

### 2. 获取余额变动明细
```javascript
GET /user/wallet/balance-changes?page=1&size=10

响应数据：
{
  "records": [
    {
      "id": 1,
      "type": "RECHARGE",
      "typeDesc": "充值",
      "changeAmount": 100.00,
      "balanceBefore": 199.50,
      "balanceAfter": 299.50,
      "description": "微信充值",
      "createdTime": "2024-01-15T10:00:00"
    }
  ],
  "total": 25,
  "current": 1,
  "pages": 3
}
```

### 3. 获取交易记录
```javascript
GET /user/wallet/transactions?page=1&size=10&type=ALL

参数：
- page: 页码
- size: 每页大小
- type: 交易类型（可选：ALL、RECHARGE、PAYMENT、REFUND）

响应数据：
{
  "records": [
    {
      "id": 1,
      "type": "PAYMENT",
      "typeDesc": "订单支付",
      "amount": 150.00,
      "status": "SUCCESS",
      "statusDesc": "成功",
      "description": "订单 #12345 支付",
      "createdTime": "2024-01-15T14:30:00"
    }
  ],
  "total": 50,
  "current": 1,
  "pages": 5
}
```

### 4. 充值接口
```javascript
POST /user/wallet/recharge

请求数据：
{
  "amount": 100.00,           // 充值金额
  "paymentMethod": 1          // 支付方式（1-微信，2-支付宝）
}

响应数据：
{
  "rechargeId": 12345,
  "amount": 100.00,
  "paymentParams": {
    // 微信/支付宝支付参数
  }
}
```

## 📱 页面路由

### 从"我的"页面跳转
```javascript
uni.navigateTo({
  url: '/pages/user/wallet'
});
```

### 跳转到充值页面
```javascript
uni.navigateTo({
  url: '/pages/recharge/recharge'
});
```

## 🎯 使用场景

### 场景1：查看余额
1. 用户进入"我的钱包"页面
2. 查看当前余额、冻结金额、累计消费
3. 了解钱包状态

### 场景2：充值
1. 点击"充值"按钮
2. 跳转到充值页面
3. 选择充值金额和支付方式
4. 完成支付

### 场景3：查看余额明细
1. 点击"余额明细"菜单
2. 查看余额变动记录
3. 了解每笔余额变动的来源
4. 上拉加载更多历史记录

### 场景4：查看交易记录
1. 点击"交易记录"菜单
2. 选择交易类型筛选（充值/支付/退款）
3. 查看交易详情和状态
4. 上拉加载更多历史记录

## 🔄 数据流转

### 余额变动流程
```
用户充值 → 余额增加 → 记录余额变动
         ↓
订单支付 → 余额冻结 → 记录交易（待支付）
         ↓
服务完成 → 冻结转消费 → 记录交易（成功）
         ↓
订单退款 → 余额退回 → 记录余额变动 + 交易（退款）
```

### 冻结金额说明
- 订单创建并支付后，金额从余额转移到冻结金额
- 服务完成后，冻结金额转为实际消费
- 订单取消后，冻结金额退回到余额

## 🎨 样式特点

### 颜色方案
- **主色** - 紫色渐变（#667eea → #764ba2）
- **成功色** - 绿色（#52c41a）
- **警告色** - 橙色（#faad14）
- **危险色** - 红色（#ff4d4f）
- **收入色** - 红色（#ff6b6b）

### 字体大小
- 标题：36rpx
- 大号金额：64rpx
- 常规文字：32rpx
- 辅助文字：28rpx
- 小号文字：24rpx

## 📝 注意事项

### 1. 数据格式
- 所有金额都保留2位小数
- 日期时间格式：`YYYY-MM-DD HH:mm`

### 2. 错误处理
- 网络错误显示友好提示
- 接口错误显示后端返回的message
- 空数据显示空状态图标和文字

### 3. 性能优化
- 使用分页加载，避免一次性加载大量数据
- 弹窗内容懒加载，打开时才请求数据
- 列表滚动到底部自动加载更多

### 4. 用户体验
- 金额显示清晰，使用大字体
- 收入和支出使用不同颜色区分
- 交易状态使用不同颜色标识
- 提供筛选功能，方便查找记录

## 🚀 后续优化建议

### 功能扩展
1. **充值优惠** - 充值满额送优惠
2. **余额预警** - 余额不足时提醒
3. **月度账单** - 生成月度消费账单
4. **导出功能** - 导出交易记录

### 体验优化
1. **骨架屏** - 加载时显示骨架屏
2. **下拉刷新** - 支持下拉刷新数据
3. **搜索功能** - 按时间、金额搜索记录
4. **图表统计** - 可视化展示消费趋势

## 📞 技术支持

如有问题，请联系开发团队。

